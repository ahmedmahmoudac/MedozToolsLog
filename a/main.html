<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase User Data</title>
</head>
<body>
    <h1>Firebase User Data</h1>

    <!-- Display User IDs -->
    <h2>User IDs</h2>
    <div id="userIds">
        <!-- User IDs will be displayed here -->
    </div>

    <!-- Select User and Display Data -->
    <h2>Select User and Display Data</h2>
    <div>
        <label for="selectUser">Select User:</label>
        <select id="selectUser">
            <!-- User options will be populated here -->
        </select>

<!-- Add Custom User ID or Username -->
<h2>Add Custom User ID or Username</h2>
<div>
    <label for="customUserId">Custom User ID or Username:</label>
    <input type="text" id="customUserId" placeholder="Enter Custom User ID or Username">
    <button onclick="addCustomUserId()">Search User</button>
</div>



    <button onclick="getUserData()">Get User Data</button>
<br>
<hr>
<div id="userData">
        <!-- User data will be displayed here -->
    </div>
<br>
<hr>
    <button onclick="editUserData()">Edit User Data</button>
<br>
<hr>
    <button onclick="saveUserData()">Save User Data</button>
<br>
<hr>

    <ul>
        <li><a href="FbTools%20FB1.html">FbTools FB1.html</a></li>
        <li><a href="fbtools2%20FB2.html">fbtools2 FB2.html</a></li>
        <li><a href="InstaTools%20INS1.html">InstaTools INS1.html</a></li>
        <li><a href="instatools2%20INS2.html">instatools2 INS2.html</a></li>
        <li><a href="main.html">main.html</a></li>
    </ul>

<br>
<hr>
<br>
<hr>
<br>
<hr>

<h2>Edit Panel For All users</h2>
    <label for="customValueIFB1">FbTools (FB1)All:</label>
     <textarea id="customValueFB1" placeholder="Enter FbTools(FB1) for All Users:" style="height: 154px; width: 686px;"></textarea>

    <button onclick="updateFbToolsFB1ForAllUsers()">Update FbTools(FB1) for All Users</button> <!-- New buttonFB1 -->
</div>

<br>
<hr>

    <label for="customValueINS1">InstaTools(INS1)All:</label>
     <textarea id="customValueINS1" placeholder="Enter InstaTools(INS1) for All Users:" style="height: 154px; width: 686px;"></textarea>

    <button onclick="updateInstaToolsINS1ForAllUsers()">Update InstaTools(INS1) for All Users</button> <!-- New buttonINS1 -->
</div>

<br>
<hr>

    <label for="customValueFB2">fbtools2 (FB2)All:</label>
     <textarea id="customValueFB2" placeholder="Enter fbtools2(FB2) for All Users:" style="height: 154px; width: 686px;"></textarea>

    <button onclick="updatefbtools2FB2ForAllUsers()">Update fbtools2 (FB2) for All Users</button> <!-- New buttonFB2 -->
</div>

<br>
<hr>

<label for="customValueINS2">instatools2 (INS2)All:</label>
<textarea id="customValueINS2" placeholder="Enter instatools2 (INS2) for All Users:" style="height: 154px; width: 686px;"></textarea>

    <button onclick="updateInstaTools2INS2ForAllUsers()">Update instatools2 (INS2) for All Users</button> <!-- New buttonINS2 -->
</div>

<br>
<hr>





    <div id="userData">
        <!-- User data will be displayed here -->
    </div>

    <!-- Display Subcollection Data for FbTools -->
    <h2>FbTools Subcollection Data</h2>
    <div id="fbToolsSubcollectionDetails">
        <!-- Subcollection details will be displayed here -->
    </div>
    <div id="fbToolsSubcollectionData">
        <!-- Subcollection data will be displayed here -->
    </div>

    <!-- Display Subcollection Data for InstaTools -->
    <h2>InstaTools Subcollection Data</h2>
    <div id="instaToolsSubcollectionDetails">
        <!-- Subcollection details will be displayed here -->
    </div>
    <div id="instaToolsSubcollectionData">
        <!-- Subcollection data will be displayed here -->
    </div>

    <!-- Display Subcollection Data for fbtools2 -->
    <h2>FbTools2 Subcollection Data</h2>
    <div id="fbtools2SubcollectionDetails">
        <!-- Subcollection details will be displayed here -->
    </div>
    <div id="fbtools2SubcollectionData">
        <!-- Subcollection data will be displayed here -->
    </div>

    <!-- Display Subcollection Data for instatools2 -->
    <h2>instatools2 Subcollection Data</h2>
    <div id="instatools2SubcollectionDetails">
        <!-- Subcollection details will be displayed here -->
    </div>
    <div id="instatools2SubcollectionData">
        <!-- Subcollection data will be displayed here -->
    </div>

    <!-- Firebase Configuration -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

    <script>
        // Firebase configuration (replace with your own Firebase project credentials)
        const firebaseConfig = {
    apiKey: "AIzaSyA5Oygn4KCqdTHuryzqD4DHUdXCjj8wFfM",
    authDomain: "file-upload-by-medoz-pro.firebaseapp.com",
    projectId: "file-upload-by-medoz-pro",
    storageBucket: "file-upload-by-medoz-pro.appspot.com",
    messagingSenderId: "575667669315",
    appId: "1:575667669315:web:b5ce5f7e7b607280dd87f6",
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);

        const db = firebase.firestore();

        // Function to get all user IDs
        function getAllUserIds() {
db.collection("accounts")
        .get()
        .then((querySnapshot) => {
            const userIds = [];
            querySnapshot.forEach((doc) => {
                const userId = doc.id;
                const username = doc.data().username; // Assuming username is a field in your document
                userIds.push({ id: userId, username: username });
            });

            // Populate the select element with user options
            const selectUser = document.getElementById("selectUser");
            userIds.forEach((user) => {
                const option = document.createElement("option");
                option.value = user.id;
                option.text = user.id + " (" + user.username + ")";
                selectUser.appendChild(option);
            });
        })
        .catch((error) => {
            console.error("Error getting user IDs with usernames:", error);
        });
}

        // Function to get user data based on the selected user
        function getUserData() {
            const selectedUserId = document.getElementById("selectUser").value;

            // Get the user document
            db.collection("accounts")
                .doc(selectedUserId)
                .get()
                .then((doc) => {
                    const userDataDiv = document.getElementById("userData");
                    userDataDiv.innerHTML = ""; // Clear previous data

                    if (doc.exists) {
                        const userData = doc.data();

                        // Create a div for user data
                        const userDataContent = document.createElement("div");
                        userDataContent.innerHTML = JSON.stringify(userData, null, 2);
                        userDataDiv.appendChild(userDataContent);

                        // Fetch and display subcollection data for InstaTools and FbTools
                        fetchSubcollectionData(selectedUserId, "FbTools", "fbToolsSubcollectionDetails", "fbToolsSubcollectionData");
                        fetchSubcollectionData(selectedUserId, "InstaTools", "instaToolsSubcollectionDetails", "instaToolsSubcollectionData");
                        fetchSubcollectionData(selectedUserId, "fbtools2", "fbtools2SubcollectionDetails", "fbtools2SubcollectionData");
                        fetchSubcollectionData(selectedUserId, "instatools2", "instatools2SubcollectionDetails", "instatools2SubcollectionData");
                    } else {
                        userDataDiv.innerHTML = "User not found.";
                        clearSubcollectionData("instaToolsSubcollectionDetails", "instaToolsSubcollectionData");
                        clearSubcollectionData("fbToolsSubcollectionDetails", "fbToolsSubcollectionData");
                    }
                })
                .catch((error) => {
                    console.error("Error getting user data:", error);
                });
        }

        // Function to fetch and display subcollection data for a given subcollection
        function fetchSubcollectionData(userId, subcollectionName, detailsId, dataId) {
            // Display the subcollection details
            const subcollectionDetailsDiv = document.getElementById(detailsId);
            subcollectionDetailsDiv.innerHTML = `Subcollection Name: ${subcollectionName}<br>Document Location: /accounts/${userId}/${subcollectionName}/YOUR_DOCUMENT_ID`;

            db.collection("accounts")
                .doc(userId)
                .collection(subcollectionName)
                .get()
                .then((querySnapshot) => {
                    const subcollectionDataDiv = document.getElementById(dataId);
                    subcollectionDataDiv.innerHTML = ""; // Clear previous data

                    const subcollectionData = [];
                    querySnapshot.forEach((doc) => {
                        subcollectionData.push(doc.data());
                    });

                    if (subcollectionData.length > 0) {
                        // Create a div for subcollection data
                        const subcollectionDataContent = document.createElement("div");
                        subcollectionDataContent.innerHTML = JSON.stringify(subcollectionData, null, 2);
                        subcollectionDataDiv.appendChild(subcollectionDataContent);
                    } else {
                        subcollectionDataDiv.innerHTML = "Subcollection is empty.";
                    }
                })
                .catch((error) => {
                    console.error("Error getting subcollection data:", error);
                });
        }

        // Function to clear subcollection details and data
        function clearSubcollectionData(detailsId, dataId) {
            document.getElementById(detailsId).innerHTML = ""; // Clear subcollection details
            document.getElementById(dataId).innerHTML = ""; // Clear subcollection data
        }

        // Function to edit user data
        function editUserData() {
            const userDataDiv = document.getElementById("userData");
            const userDataContent = userDataDiv.querySelector("div");
            const userData = JSON.parse(userDataContent.textContent);

            // Create input fields for each data field
            userDataDiv.innerHTML = ""; // Clear previous data
            for (const key in userData) {
                if (userData.hasOwnProperty(key)) {
                    const input = document.createElement("input");
                    input.type = "text";
                    input.value = userData[key];
                    input.setAttribute("data-field", key);
                    userDataDiv.appendChild(input);
                }
            }
        }


// Function to edit fbtools2 Subcollection Data
function editfbtools2Data() {
    const selectedUserId = document.getElementById("selectUser").value;

    db.collection("accounts")
        .doc(selectedUserId)
        .collection("fbtools2")
        .get()
        .then((querySnapshot) => {
            const fbtools2DataDiv = document.getElementById("fbtools2SubcollectionData");
            fbtools2DataDiv.innerHTML = ""; // Clear previous data

            const fbtools2Data = [];
            querySnapshot.forEach((doc) => {
                fbtools2Data.push({ id: doc.id, ...doc.data() });
            });

            if (fbtools2Data.length > 0) {
                // Create an input field for editing FB2
                const input = document.createElement("input");
                input.type = "text";
                input.value = fbtools2Data[0].FB2;
                input.setAttribute("data-field", "FB2");
                fbtools2DataDiv.appendChild(input);

                // Store the document ID in a hidden input field
                const hiddenInput = document.createElement("input");
                hiddenInput.type = "hidden";
                hiddenInput.value = fbtools2Data[0].id;
                hiddenInput.setAttribute("data-field", "docId");
                fbtools2DataDiv.appendChild(hiddenInput);
            } else {
                fbtools2DataDiv.innerHTML = "fbtools2 data not found.";
            }
        })
        .catch((error) => {
            console.error("Error getting fbtools2 data:", error);
        });
}

// Function to save edited fbtools2 Subcollection Data
function savefbtools2Data() {



    const selectedUserId = document.getElementById("selectUser").value;
    const fbtools2DataDiv = document.getElementById("fbtools2SubcollectionData");
    const inputField = fbtools2DataDiv.querySelector("input[data-field='FB2']");
    const docIdField = fbtools2DataDiv.querySelector("input[data-field='docId']");

    const updatedData = {
        FB2: inputField.value,
    };

    const docId = docIdField.value; // Get the document ID

    // Update the fbtools2 document with the edited data
    db.collection("accounts")
        .doc(selectedUserId)
        .collection("fbtools2")
        .doc(docId)
        .set(updatedData, { merge: true }) // Use merge: true to update the existing document
        .then(() => {
            // Show a success message or perform any other desired action
            console.log("fbtools2 data updated successfully.");
        })
        .catch((error) => {
            console.error("Error updating fbtools2 data:", error);
        });

    // Restore the fbtools2 data display
    fetchSubcollectionData(selectedUserId, "fbtools2", "fbtools2SubcollectionDetails", "fbtools2SubcollectionData");
}

// Function to update a value for all users in "fbtools2" subcollection
function updatefbtools2FB2ForAllUsers() {
    // Get a reference to the "accounts" collection
    const accountsRef = db.collection("accounts");

    // Get the custom value from the input textbox
    const customValueFB2 = document.getElementById("customValueFB2").value;

    // Fetch all user documents for fbtools2
    accountsRef.get()
        .then((querySnapshot) => {
            querySnapshot.forEach((userDoc) => {
                // Check if the document exists in the "fbtools2" subcollection
                const userId = userDoc.id;
                const fbtools2CollectionRef = accountsRef.doc(userId).collection("fbtools2");

                fbtools2CollectionRef.get()
                    .then((querySnapshot) => {
                        // Check if there's at least one document in the subcollection
                        if (!querySnapshot.empty) {
                            // Update the value for all documents in the subcollection with the custom value
                            querySnapshot.forEach((doc) => {
                                const updatedData = {
                                    FB2: customValueFB2,
                                };

                                const docRef = fbtools2CollectionRef.doc(doc.id);

                                docRef.set(updatedData, { merge: true })
                                    .then(() => {
                                        console.log(`Value updated for user ${userId}, document ID ${doc.id}`);
                                    })
                                    .catch((error) => {
                                        console.error(`Error updating value for user ${userId}, document ID ${doc.id}:`, error);
                                    });
                            });
                        } else {
                            console.log(`No documents found in "fbtools2" subcollection for user ${userId}. Skipping.`);
                        }
                    })
                    .catch((error) => {
                        console.error(`Error fetching documents in "fbtools2" subcollection for user ${userId}:`, error);
                    });
            });
        })
        .catch((error) => {
            console.error("Error fetching user documents:", error);
        });
}




// Function to edit instatools2 Subcollection Data
function editInstatools2Data() {



 const selectedUserId = document.getElementById("selectUser").value;

    db.collection("accounts")
        .doc(selectedUserId)
        .collection("instatools2")
        .get()
        .then((querySnapshot) => {
            const instatools2DataDiv = document.getElementById("instatools2SubcollectionData");
            instatools2DataDiv.innerHTML = ""; // Clear previous data

            const instatools2Data = [];
            querySnapshot.forEach((doc) => {
                instatools2Data.push({ id: doc.id, ...doc.data() });
            });

            if (instatools2Data.length > 0) {
                // Create an input field for editing INS2
                const input = document.createElement("input");
                input.type = "text";
                input.value = instatools2Data[0].INS2;
                input.setAttribute("data-field", "INS2");
                instatools2DataDiv.appendChild(input);

                // Store the document ID in a hidden input field
                const hiddenInput = document.createElement("input");
                hiddenInput.type = "hidden";
                hiddenInput.value = instatools2Data[0].id;
                hiddenInput.setAttribute("data-field", "docId");
                instatools2DataDiv.appendChild(hiddenInput);
            } else {
                instatools2DataDiv.innerHTML = "instatools2 data not found.";
            }
        })
        .catch((error) => {
            console.error("Error getting instatools2 data:", error);
        });
}

// Function to save edited instatools2 Subcollection Data
function saveInstatools2Data() {

    // Get the custom value from the input textbox
    const customValueINS2CustomUser = document.getElementById("customValueINS2CustomUser").value;

    const selectedUserId = document.getElementById("selectUser").value;
    const instatools2DataDiv = document.getElementById("instatools2SubcollectionData");
    const inputField = instatools2DataDiv.querySelector("input[data-field='INS2']");
    const docIdField = instatools2DataDiv.querySelector("input[data-field='docId']");

    const updatedData = {
        INS2: customValueINS2CustomUser,
    };

    const docId = docIdField.value; // Get the document ID

    // Update the instatools2 document with the edited data
    db.collection("accounts")
        .doc(selectedUserId)
        .collection("instatools2")
        .doc(docId)
        .set(updatedData, { merge: true }) // Use merge: true to update the existing document
        .then(() => {
            // Show a success message or perform any other desired action
            console.log("instatools2 data updated successfully.");
        })
        .catch((error) => {
            console.error("Error updating instatools2 data:", error);
        });

    // Restore the instatools2 data display
    fetchSubcollectionData(selectedUserId, "instatools2", "instatools2SubcollectionDetails", "instatools2SubcollectionData");
}

// Function to update a value for all users in "InstaTools" subcollection
function updateInstaToolsINS1ForAllUsers() {
    // Get a reference to the "accounts" collection
    const accountsRef = db.collection("accounts");

    // Get the custom value from the input textbox
    const customValueINS1 = document.getElementById("customValueINS1").value;

    // Fetch all user documents for InstaTools
    accountsRef.get()
        .then((querySnapshot) => {
            querySnapshot.forEach((userDoc) => {
                // Check if the document exists in the "InstaTools" subcollection
                const userId = userDoc.id;
                const InstaToolsCollectionRef = accountsRef.doc(userId).collection("InstaTools");

                InstaToolsCollectionRef.get()
                    .then((querySnapshot) => {
                        // Check if there's at least one document in the subcollection
                        if (!querySnapshot.empty) {
                            // Update the value for all documents in the subcollection with the custom value
                            querySnapshot.forEach((doc) => {
                                const updatedData = {
                                    INS1: customValueINS1,
                                };

                                const docRef = InstaToolsCollectionRef.doc(doc.id);

                                docRef.set(updatedData, { merge: true })
                                    .then(() => {
                                        console.log(`Value updated for user ${userId}, document ID ${doc.id}`);
                                    })
                                    .catch((error) => {
                                        console.error(`Error updating value for user ${userId}, document ID ${doc.id}:`, error);
                                    });
                            });
                        } else {
                            console.log(`No documents found in "InstaTools" subcollection for user ${userId}. Skipping.`);
                        }
                    })
                    .catch((error) => {
                        console.error(`Error fetching documents in "InstaTools" subcollection for user ${userId}:`, error);
                    });
            });
        })
        .catch((error) => {
            console.error("Error fetching user documents:", error);
        });
}



// Function to edit FbTools Subcollection Data
function editFbToolsData() {
    const selectedUserId = document.getElementById("selectUser").value;

    db.collection("accounts")
        .doc(selectedUserId)
        .collection("FbTools")
        .get()
        .then((querySnapshot) => {
            const FbToolsDataDiv = document.getElementById("FbToolsSubcollectionData");
            FbToolsDataDiv.innerHTML = ""; // Clear previous data

            const FbToolsData = [];
            querySnapshot.forEach((doc) => {
                FbToolsData.push({ id: doc.id, ...doc.data() });
            });

            if (FbToolsData.length > 0) {
                // Create an input field for editing INS1
                const input = document.createElement("input");
                input.type = "text";
                input.value = FbToolsData[0].INS1;
                input.setAttribute("data-field", "INS1");
                FbToolsDataDiv.appendChild(input);

                // Store the document ID in a hidden input field
                const hiddenInput = document.createElement("input");
                hiddenInput.type = "hidden";
                hiddenInput.value = FbToolsData[0].id;
                hiddenInput.setAttribute("data-field", "docId");
                FbToolsDataDiv.appendChild(hiddenInput);
            } else {
                FbToolsDataDiv.innerHTML = "FbTools data not found.";
            }
        })
        .catch((error) => {
            console.error("Error getting FbTools data:", error);
        });
}

// Function to save edited FbTools Subcollection Data
function saveFbToolsData() {
    const selectedUserId = document.getElementById("selectUser").value;
    const FbToolsDataDiv = document.getElementById("FbToolsSubcollectionData");
    const inputField = FbToolsDataDiv.querySelector("input[data-field='INS1']");
    const docIdField = FbToolsDataDiv.querySelector("input[data-field='docId']");

    const updatedData = {
        INS1: inputField.value,
    };

    const docId = docIdField.value; // Get the document ID

    // Update the FbTools document with the edited data
    db.collection("accounts")
        .doc(selectedUserId)
        .collection("FbTools")
        .doc(docId)
        .set(updatedData, { merge: true }) // Use merge: true to update the existing document
        .then(() => {
            // Show a success message or perform any other desired action
            console.log("FbTools data updated successfully.");
        })
        .catch((error) => {
            console.error("Error updating FbTools data:", error);
        });

    // Restore the FbTools data display
    fetchSubcollectionData(selectedUserId, "FbTools", "FbToolsSubcollectionDetails", "FbToolsSubcollectionData");
}

// Function to update a value for all users in "FbTools" subcollection
function updateFbToolsFB1ForAllUsers() {
    // Get a reference to the "accounts" collection
    const accountsRef = db.collection("accounts");

    // Get the custom value from the input textbox
    const customValueFB1 = document.getElementById("customValueFB1").value;

    // Fetch all user documents for FbTools
    accountsRef.get()
        .then((querySnapshot) => {
            querySnapshot.forEach((userDoc) => {
                // Check if the document exists in the "FbTools" subcollection
                const userId = userDoc.id;
                const FbToolsCollectionRef = accountsRef.doc(userId).collection("FbTools");

                FbToolsCollectionRef.get()
                    .then((querySnapshot) => {
                        // Check if there's at least one document in the subcollection
                        if (!querySnapshot.empty) {
                            // Update the value for all documents in the subcollection with the custom value
                            querySnapshot.forEach((doc) => {
                                const updatedData = {
                                    FB1: customValueFB1,
                                };

                                const docRef = FbToolsCollectionRef.doc(doc.id);

                                docRef.set(updatedData, { merge: true })
                                    .then(() => {
                                        console.log(`Value updated for user ${userId}, document ID ${doc.id}`);
                                    })
                                    .catch((error) => {
                                        console.error(`Error updating value for user ${userId}, document ID ${doc.id}:`, error);
                                    });
                            });
                        } else {
                            console.log(`No documents found in "FbTools" subcollection for user ${userId}. Skipping.`);
                        }
                    })
                    .catch((error) => {
                        console.error(`Error fetching documents in "FbTools" subcollection for user ${userId}:`, error);
                    });
            });
        })
        .catch((error) => {
            console.error("Error fetching user documents:", error);
        });
}




// Function to select an existing option based on user input
function addCustomUserId() {
    const customUserId = document.getElementById("customUserId").value.trim();
    
    if (customUserId) {
        const selectUser = document.getElementById("selectUser");
        
        // Check if the custom user ID or username already exists in the select options
        const existingOptions = Array.from(selectUser.options);
        const existingOption = existingOptions.find(option => {
            const optionValue = option.value;
            const optionText = option.text;
            
            // Check if the custom input matches either the value or the text of the option
            return optionValue === customUserId || optionText.includes(`(${customUserId})`);
        });
        
        if (existingOption) {
            // Select the existing option
            selectUser.value = existingOption.value;
        } else {
            alert("The custom user ID or username does not exist in the select options.");
        }
    } else {
        alert("Please enter a valid custom user ID or username.");
    }
}




        // Function to save edited user data
        function saveUserData() {
            const selectedUserId = document.getElementById("selectUser").value;
            const userDataDiv = document.getElementById("userData");
            const inputFields = userDataDiv.querySelectorAll("input");

            const updatedData = {};
            inputFields.forEach((input) => {
                const field = input.getAttribute("data-field");
                const value = input.value;
                updatedData[field] = value;
            });

            // Update the user document with the edited data
            db.collection("accounts")
                .doc(selectedUserId)
                .update(updatedData)
                .then(() => {
                    // Show a success message or perform any other desired action
                    console.log("User data updated successfully.");
                })
                .catch((error) => {
                    console.error("Error updating user data:", error);
                });

            // Restore the user data display
            getUserData();
        }

        // Call the function to get all user IDs when the page loads
        getAllUserIds();
    </script>
</body>
</html>
